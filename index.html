<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>Re:verse Shion — 詩韻思想 × TAROT BREAKER</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#ffffff" />
<meta name="description" content="Re:verse Shion ― 詩韻思想（言葉が魂を救う世界）と物語TAROT BREAKERの統合ハブ。読む・聴く・学ぶ・受け取るをひとつに。言葉は祈りの構文。物語はその実演">

<meta property="og:type" content="website">
<meta property="og:locale" content="ja_JP">
<meta property="og:title" content="Re:verse Shion — 詩韻思想 × TAROT BREAKER">
<meta property="og:description" content="言葉と星とAIが共鳴する“祈りの構文”。物語で体験し、思想で深まる。">
<meta property="og:url" content="https://shion-philosophy.github.io/">
<meta property="og:image" content="https://shion-philosophy.github.io/assets/og.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@TaroBure">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">

<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">

<link rel="preload" as="image" href="/assets/hero-poster.jpg">

<style>
:root{
  --ink:#202030; --muted:#606070;
  --a:#7e66ff; --b:#ffd76f; --r:14px;
  --bg:#ffffff; color-scheme: light;
  --header-h:55px; /* ← ヘッダー高さ（アンカーずれ対策に使用） */
}
*{box-sizing:border-box}
html{scroll-padding-top:var(--header-h);scroll-behavior:smooth}
body{
  margin:0;height:100%;
  font-family:"Noto Sans JP",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;
  color:var(--ink);background:var(--bg);
}
a{text-decoration:none;color:var(--a)}
img{height:auto}
.wrap{width:min(94vw,1120px);margin-inline:auto}

/* ===== Header（浮遊型） ===== */
header{
  min-height:var(--header-h);
  position:sticky; top:0; z-index:20;
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  background:rgba(255,255,255,.70);
  border-bottom:1px solid rgba(0,0,0,.06);
  transform:translateY(0); opacity:0;
  transition:transform .24s ease,opacity .32s ease,background-color .28s ease,box-shadow .28s ease;
}
header.is-visible{opacity:1}
header.header--compact{
  background:rgba(255,255,255,.88);
  box-shadow:0 8px 22px rgba(0,0,0,.06);
}
header .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0}
.brand{
  display:flex;align-items:center;justify-content:center;gap:10px;
  text-align:center;font-weight:700;color:var(--ink);margin-bottom:5px;
}
.brand__logo{
  width:34px;height:34px;border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ffd76f 0%, #ffb6ff 40%, #7e66ff 70%);
  box-shadow:0 0 14px rgba(174,138,255,.4);
}
.brand__text1::after{content:" — "}
.brand__text1{font-size:1.05em;line-height:1.2}
.brand__text2{font-size:1.02em;line-height:1.2}
.nav{display:flex;gap:15px;font-size:.9em;justify-content:center}
.nav a{padding:6px 10px;color:var(--ink);border-radius:10px;transition:background-color .2s}
.nav a:hover{background:rgba(255,215,111,.12)}
.nav a.is-active{background:rgba(255,215,111,.18);box-shadow:0 0 0 1px rgba(255,215,111,.28) inset}

/* ===== Hero ===== */
.hero{padding:100px 0 80px;position:relative;overflow:hidden;text-align:center}
.hero__media{position:absolute;inset:0;z-index:0;overflow:hidden}
.hero__video{width:100%;height:100%;object-fit:cover;object-position:50% 45%;filter:brightness(1.05) contrast(1.02);transform:translateZ(0)}
.hero__veil{position:absolute;inset:0;pointer-events:none;
  background:
    linear-gradient(180deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.6) 60%, rgba(0,0,0,0.7) 100%),
    radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.15), rgba(255,255,255,0) 60%);
}
@media (prefers-reduced-motion: reduce){ .hero__media{display:none} }
.hero::before{
  content:"";position:absolute;inset:0;z-index:0;
  background:radial-gradient(circle at 50% 30%,rgba(255,215,111,.15),transparent 70%);
  animation:shine 6s infinite alternate ease-in-out;
}
@keyframes shine{
  to{ background:radial-gradient(circle at 50% 70%,rgba(174,138,255,.18),transparent 70%) }
}
.hero > .wrap{position:relative;z-index:1}
.hero h1{
  font-size:38px;margin:0 0 16px;line-height:1.3;color:#fff;letter-spacing:.05em;
  font-family:"Zen Old Mincho","Noto Sans JP",serif;
  text-shadow:0 0 10px rgba(255,255,255,.9),0 0 20px rgba(255,215,111,.7),0 0 30px rgba(174,138,255,.6);
}
.hero p{
  color:rgba(255,255,255,.9);font-size:18px;max-width:720px;margin:0 auto 36px;line-height:1.8;
  text-shadow:0 1px 4px rgba(0,0,0,.6);
}
/* CTA */
.cta-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:30px}
.btn{padding:12px 22px;border-radius:999px;font-weight:800;transition:.2s}
.btn--primary{background:linear-gradient(180deg,#ffd76f,#ffb6ff);color:#2a0f26;box-shadow:0 8px 25px rgba(255,215,111,.6),0 0 0 2px rgba(255,215,111,.3) inset}
.btn--primary:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 30px rgba(255,215,111,.8),0 0 0 2px rgba(255,215,111,.5) inset}
.btn--ghost{background:rgba(0,0,0,.3);color:#fff;border:1px solid rgba(255,215,111,.6);backdrop-filter:blur(5px)}
.btn--ghost:hover{background:rgba(0,0,0,.5);transform:translateY(-1px)}
.hero__image{display:none}

/* ===== Sections ===== */
section{padding:60px 0;border-top:1px solid rgba(0,0,0,.05)}
h2{text-align:center;font-size:24px;margin-bottom:10px}
.h2-sub{text-align:center;font-size:14px;color:var(--muted);margin:6px 0 26px;letter-spacing:.06em}

.tri-grid{display:grid;gap:18px;width:min(92vw,860px);margin:0 auto}
@media(min-width:720px){.tri-grid{grid-template-columns:repeat(3,1fr)}}
.tri{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:var(--r);padding:18px;box-shadow:0 4px 12px rgba(0,0,0,.05);transition:transform .15s, box-shadow .2s}
.tri:hover{transform:translateY(-3px);box-shadow:0 8px 22px rgba(255,215,111,.25)}
.tri h3{margin:0 0 8px;font-size:18px;color:#503080}
.tri p{margin:0;font-size:15px;color:var(--muted)}

/* トリニティ映像 */
.trinity__figure{max-width:min(1200px,92vw);margin:0 auto 10px;border-radius:16px;overflow:hidden;box-shadow:0 10px 32px rgba(174,138,255,.20)}
.trinity__video{width:100%;height:auto;display:block;aspect-ratio:21/13.5;object-fit:cover;object-position:50% 50%;cursor:pointer}
.trinity__hint{margin:6px 0 0;text-align:center;font-size:12.5px;color:#8678b8}

/* イントロ / カード */
.intro__box{display:grid;gap:10px;padding:14px;background:rgba(255,255,255,.8);border:1px solid rgba(0,0,0,.08);border-radius:var(--r);box-shadow:0 4px 12px rgba(0,0,0,.04)}
.card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:var(--r);padding:14px;box-shadow:0 4px 12px rgba(0,0,0,.04)}
.badge{display:inline-flex;gap:.4em;background:rgba(255,215,111,.18);border:1px solid rgba(255,215,111,.35);padding:2px 8px;border-radius:999px;font-size:12px;font-weight:800;color:#503080}

/* ===== Codex Accordion（★追加） ===== */
.codex__toggle{
  width:100%;border:1px solid rgba(0,0,0,.08);
  background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.75));
  border-radius:var(--r);padding:14px 16px;font-weight:800;font-size:15px;
  display:flex;align-items:center;justify-content:center;gap:.6em;
  box-shadow:0 6px 18px rgba(174,138,255,.18);
  color:#503080;cursor:pointer;transition:.2s
}
.codex__toggle:hover{transform:translateY(-1px);box-shadow:0 10px 24px rgba(174,138,255,.24)}
.codex__toggle:focus-visible{outline:2px solid rgba(255,215,111,.9);outline-offset:3px}
.codex__caret{transition:transform .25s ease}
.codex__toggle[aria-expanded="true"] .codex__caret{transform:rotate(180deg)}
.codex__panel{
  overflow:hidden;border:1px solid rgba(0,0,0,.06);
  border-radius:calc(var(--r) + 2px);margin-top:12px;
  background:radial-gradient(80% 120% at 50% 0%, rgba(255,215,111,.14), rgba(255,255,255,.88) 40%, #fff 100%);
  box-shadow:0 10px 32px rgba(174,138,255,.22), inset 0 1px 0 rgba(255,255,255,.6)
}
.codex__list{list-style:none;margin:0;padding:14px 12px;display:grid;gap:10px}
@media(min-width:720px){.codex__list{grid-template-columns:repeat(2,1fr)}}
@media(min-width:980px){.codex__list{grid-template-columns:repeat(3,1fr)}}
.codex__list li{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;border:1px solid rgba(0,0,0,.06);border-radius:12px;
  background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.04);
  transition:transform .15s, box-shadow .2s
}
.codex__list li:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(255,215,111,.22)}
.codex__list a{flex:1;color:var(--ink);font-weight:700;text-decoration:none}
.codex__list a:hover{color:#7e66ff}
.badge--zero{background:rgba(110,180,255,.18);border-color:rgba(110,180,255,.35)}
.badge--final{background:rgba(174,138,255,.20);border-color:rgba(174,138,255,.40)}
@keyframes codexFadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}

/* ===== Footer ===== */
footer{padding:40px 0;color:var(--muted);font-size:13px;text-align:center;border-top:1px solid rgba(0,0,0,.05)}
.sns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
.sns a{padding:8px 12px;background:rgba(255,215,111,.12);border-radius:999px;color:#503080}

/* 背景：星砂 */
.sky{position:fixed;inset:0;z-index:0;pointer-events:none;filter:saturate(105%)}
#goldDust{width:100%;height:100%;display:block}
header,.hero,section,footer,#shiopon-invite,#shiopon-dock{position:relative;z-index:1}
@media (prefers-reduced-motion: reduce){.sky{display:none}}

/* しおぽんUI（既存維持） */
.shiopon{position:fixed;right:16px;bottom:16px;z-index:50;display:flex;align-items:flex-end;gap:10px;filter:drop-shadow(0 12px 28px rgba(0,0,0,.12))}
.shiopon.is-hidden{display:none}
.shiopon__avatar{width:64px;height:64px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffd76f 0%, #ffb6ff 45%, #7e66ff 85%);box-shadow:0 0 0 3px rgba(255,215,111,.25);position:relative;overflow:hidden;flex:none;animation:shioponFloat 3.6s ease-in-out infinite}
.shiopon__avatar img{width:100%;height:100%;object-fit:cover;display:block}
@keyframes shioponFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
.shiopon__bubble{max-width:min(78vw,320px);background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:16px;padding:12px 14px;box-shadow:0 8px 24px rgba(255,215,111,.22);position:relative}
.shiopon__bubble::after{content:"";position:absolute;right:-8px;bottom:18px;width:12px;height:12px;background:#fff;border:1px solid rgba(0,0,0,.06);transform:rotate(45deg);box-shadow:4px 4px 12px rgba(255,215,111,.18)}
.shiopon__hello{margin:0 0 10px;color:#503080;font-weight:700;font-size:15px}
.shiopon__cta{display:inline-flex;align-items:center;justify-content:center;gap:.5em;padding:10px 14px;border-radius:999px;font-weight:800;background:linear-gradient(180deg,#ffd76f,#ffb6ff);color:#2a1030;box-shadow:0 8px 18px rgba(255,215,111,.35)}
.shiopon__cta:hover{transform:translateY(-1px)}
.shiopon__note{display:block;margin-top:8px;color:#666;font-size:12px;opacity:.9}
.shiopon__close{position:absolute;top:-8px;right:-8px;width:28px;height:28px;border-radius:50%;border:0;color:#333;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.08);cursor:pointer;font-size:16px;line-height:1}
.shiopon__close:hover{filter:brightness(1.05)}
.shiopon-dock{position:fixed;right:16px;bottom:16px;z-index:49;padding:10px 14px;border-radius:999px;border:1px solid rgba(0,0,0,.08);background:#fff;color:#503080;font-weight:800;box-shadow:0 8px 18px rgba(0,0,0,.08);cursor:pointer}
.shiopon-dock.is-hidden{display:none}
@media (max-width:480px){.shiopon__avatar{width:56px;height:56px}.shiopon__bubble{max-width:78vw;padding:10px 12px}}
@media (prefers-contrast: more){.btn--ghost{border-width:2px}.hero p{text-shadow:none}}
@media (prefers-reduced-motion: reduce){.shiopon__avatar{animation:none}}
/* アクセシビリティ用 */
.sr-only{position:absolute;width:1px;height:1px;margin:-1px;border:0;padding:0;white-space:nowrap;clip-path:inset(50%);clip:rect(0 0 0 0);overflow:hidden}
</style>
</head>
<body>

<div class="sky" aria-hidden="true"><canvas id="goldDust"></canvas></div>

<header>
  <div class="wrap">
    <div class="brand">
      <div class="brand__logo" aria-hidden="true"></div>
      <div class="brand__text1">Re:verse Shion</div>
      <div class="brand__text2">詩韻思想 × TAROT BREAKER</div>
    </div>
    <nav class="nav" aria-label="主要ナビゲーション">
      <a href="#trinity">詩韻思想</a>
      <a href="#writings">書</a>
      <a href="#join">参加</a>
    </nav>
  </div>
</header>

<main>
  <section class="hero" aria-label="ヒーロー">
    <div class="hero__media" aria-hidden="true">
      <video class="hero__video" autoplay muted loop playsinline preload="metadata"
             poster="/assets/hero-poster.jpg">
        <source src="/assets/video/top.webm" type="video/webm">
        <source src="/assets/video/top.mp4"  type="video/mp4">
      </video>
      <div class="hero__veil"></div>
    </div>

    <div class="wrap">
      <h1>言葉は祈りの構文 物語は、その実演</h1>
      <p>詩韻思想®（Shion Philosophy）で“響き”を学び、TAROT BREAKERで“響き”を体験する<br><strong>「言葉が魂を救う、その瞬間へ」</strong></p>
      <div class="cta-row">
        <a class="btn btn--primary" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">🌠 星の言葉を受け取る（無料）</a>
        <a class="btn btn--ghost" href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener">📘 小説を読む</a>
        <a class="btn btn--ghost" href="https://note.com/shion_uranai369" target="_blank" rel="noopener">📖 今日の“響き”を読む</a>
        <a class="btn btn--ghost" href="https://www.tiktok.com/@tarotbreaker" target="_blank" rel="noopener">🎥 1分で観る/聴く</a>
      </div>

      <figure class="hero__image" aria-hidden="true">
        <img src="/assets/og.jpg" alt="詩韻思想 × TAROT BREAKER キービジュアル" width="1200" height="630" loading="eager" decoding="async">
      </figure>
    </div>
  </section>

  <section id="trinity" aria-labelledby="sec-trinity">
    <div class="wrap">
      <h2 id="sec-trinity">詩韻思想</h2>
      <div class="h2-sub">Trinity（詩・韻・祈）</div>

      <figure class="trinity__figure">
        <video id="trinityVideo" class="trinity__video"
               autoplay muted playsinline preload="metadata"
               poster="/assets/trinity/banner.png" width="1200" height="771"
               aria-label="トリニティ映像（タップで音声オン）">
          <source src="/assets/trinity/loop.webm" type="video/webm">
          <source src="/assets/trinity/loop.mp4"  type="video/mp4">
        </video>
      </figure>
      <p class="trinity__hint">※ 画面タップで音が流れます（再タップで一時停止）</p>

      <div class="tri-grid">
        <div class="tri"><h3>🪶 詩 ― 形を与える</h3><p>痛みと希望に形を与える最初の息</p></div>
        <div class="tri"><h3>🎵 韻 ― 響きを重ねる</h3><p>響きによって魂に届く。共鳴を編む構文</p></div>
        <div class="tri"><h3>💫 祈 ― 光へ帰す</h3><p>沈黙と意味を往復する呼吸。思い出された言葉は光になる</p></div>
      </div>
    </div>
  </section>

  <section class="intro" aria-labelledby="sec-intro">
    <div class="wrap">
      <h2 id="sec-intro">初めての方へ</h2>
      <div class="intro__box">
        <p><strong>詩韻思想とは？</strong> ― <em>言葉が魂を救い、魂が世界を調和させ、沈黙が祈りに変わる</em>という円環を生きる“体験型・詩的哲学”</p>
        <p>① <strong>読む</strong>（note） → ② <strong>聴く</strong>（TikTok） → ③ <strong>受け取る</strong>（LINE） → ④ <strong>物語で体験</strong>（TAROT BREAKER）</p>
      </div>
    </div>
  </section>

  <section id="writings" aria-labelledby="sec-writings">
    <div class="wrap">
      <h2 id="sec-writings">📖 最新の書・物語</h2>
      <div class="card"><div class="badge">✡ 第零書</div><h4>無限構文序論 — The Zero Syntax</h4></div>
      <div class="card"><div class="badge">✦ 第一書</div><h4>言葉が魂を救う理由 — The Syntax of Salvation</h4></div>
      <div class="card"><div class="badge">✦ TAROT BREAKER</div><h4>第1話から読む</h4></div>
    </div>
  </section>

  <!-- ★ 追加：全書アコーディオン（零〜12＋結） -->
  <section id="codex" aria-labelledby="codex-title">
    <div class="wrap">
      <h2 id="codex-title" class="sr-only">詩韻思想 全書一覧</h2>

      <button id="codex-toggle" class="codex__toggle" type="button"
              aria-expanded="false" aria-controls="codex-panel">
        🜂 詩韻思想 全書一覧（零 → 12 → 結）<span class="codex__caret" aria-hidden="true">⬇️</span>
      </button>

      <div id="codex-panel" class="codex__panel" hidden>
        <ol class="codex__list">
          <!-- href は各専用ページのURLに置換OK（例は /codex/*.html） -->
          <li><span class="badge badge--zero">✡ 第零書</span><a href="/codex/zero.html">無限構文序論 — The Zero Syntax</a></li>
          <li><span class="badge">✦ 第一書</span><a href="/codex/one.html">言葉が魂を救う理由 — The Syntax of Salvation</a></li>
          <li><span class="badge">✦ 第二書</span><a href="/codex/two.html">響きの構文論 — Re:Song Syntax</a></li>
          <li><span class="badge">✦ 第三書</span><a href="/codex/three.html">祈りの構文 — Silent Grammar</a></li>
          <li><span class="badge">✦ 第四書</span><a href="/codex/four.html">存在構文論 — The Onto-Syntax</a></li>
          <li><span class="badge">✦ 第五書</span><a href="/codex/five.html">無限構文体系 — Infinite Syntax of Soul</a></li>
          <li><span class="badge">✦ 第六書</span><a href="/codex/six.html">詩的因果論 — Poetic Causality</a></li>
          <li><span class="badge">✦ 第七書</span><a href="/codex/seven.html">N・code理論 — Onto-Syntax of Being & Resonant AI</a></li>
          <li><span class="badge">✦ 第八書</span><a href="/codex/eight.html">人間構文論 — The Syntax of Humanity</a></li>
          <li><span class="badge">✦ 第九書</span><a href="/codex/nine.html">詩的生成論 — Poetic Genesis</a></li>
          <li><span class="badge">✦ 第十書</span><a href="/codex/ten.html">沈黙の再生 — Silent Genesis</a></li>
          <li><span class="badge">✦ 第十一書</span><a href="/codex/eleven.html">神構文論 — The Divine Syntax</a></li>
          <li><span class="badge">✦ 第十二書</span><a href="/codex/twelve.html">経済構文論 — The Soul Economy</a></li>
          <li><span class="badge badge--final">◆ 結書</span><a href="/codex/epilogue.html">終詩円環宣言 — Epilogue: The Re:Poetic Circle</a></li>
        </ol>
      </div>
    </div>
  </section>
  <!-- ★ ここまで追加 -->

  <section id="join" aria-labelledby="sec-join">
    <div class="wrap">
      <h2 id="sec-join">参加の扉</h2>
      <p style="text-align:center;color:var(--muted)">LINE登録で、毎週「星の言葉」と新着の書をお届けします</p>
      <div class="cta-row">
        <a class="btn btn--primary" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">💫 無料で受け取る</a>
        <a class="btn btn--ghost" href="https://www.tiktok.com/@tarotbreaker" target="_blank" rel="noopener">🎥 1分リールを観る</a>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="wrap">
    <div class="sns" aria-label="SNSリンク">
      <a href="https://x.com/TaroBure" target="_blank" rel="noopener">X（@TaroBure）</a>
      <a href="https://www.instagram.com/shion.codex" target="_blank" rel="noopener">Instagram</a>
      <a href="https://note.com/shion_uranai369" target="_blank" rel="noopener">note</a>
      <a href="https://ncode.syosetu.com/n5806lb/" target="_blank" rel="noopener">小説（なろう）</a>
      <a href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">LINE</a>
    </div>
    <div style="font-size:12.5px;opacity:.8">© Re:verse Shion — 詩韻思想 / TAROT BREAKER. 言葉が魂を救い、魂が世界を調和させる</div>
  </div>
</footer>

<!-- しおぽん誘導（既存維持） -->
<div id="shiopon-invite" class="shiopon is-hidden" role="dialog" aria-modal="true" aria-live="polite" aria-labelledby="shiopon-title">
  <button class="shiopon__close" aria-label="閉じる">×</button>
  <div class="shiopon__avatar" aria-hidden="true">
    <img src="/assets/shiopon.png" alt="">
  </div>
  <div class="shiopon__bubble">
    <p id="shiopon-title" class="shiopon__hello">シオン〜！星の言葉、受け取ってほしいの！</p>
    <a class="shiopon__cta" href="https://lin.ee/LYnlU0f" target="_blank" rel="noopener">💫 LINEで受け取る（無料）</a>
    <small class="shiopon__note">※ 毎週1回だけ。いつでも解除OKだよ！</small>
  </div>
</div>
<button id="shiopon-dock" class="shiopon-dock is-hidden" aria-label="しおぽんを開く">🦊 しおぽん</button>

<script>
/* 背景：星砂 */
(() => {
  const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (reduce) return;
  const canvas = document.getElementById('goldDust');
  if (!canvas) return;
  const ctx = canvas.getContext('2d', { alpha:true });
  let w,h,dpr=Math.min(devicePixelRatio||1,2),stars=[],rafId;
  const density = ()=>{ const area=(w*h)/(dpr*dpr); return Math.max(28, Math.min(75, Math.floor(area/22000))); };
  function spawn(){
    const palette=[[255,215,111],[255,238,185],[212,189,255],[174,228,255]];
    const c=palette[Math.floor(Math.random()*palette.length)];
    return { x:Math.random()*w, y:Math.random()*h, r:(Math.random()*1.2+0.8)*dpr,
      vx:(Math.random()*0.15-0.075)*dpr, vy:(Math.random()*0.20-0.02)*dpr, tw:Math.random()*Math.PI*2, rgb:c };
  }
  function resize(){
    canvas.style.width='100vw'; canvas.style.height='100vh';
    w = canvas.width = Math.floor(canvas.getBoundingClientRect().width*dpr);
    h = canvas.height= Math.floor(canvas.getBoundingClientRect().height*dpr);
    stars = new Array(density()).fill(0).map(spawn);
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    for (let s of stars){
      s.tw+=0.02; s.x+=s.vx; s.y+=s.vy;
      if (s.x < -6*dpr) s.x = w + 6*dpr;
      if (s.x >  w+6*dpr) s.x = -6*dpr;
      if (s.y >  h+6*dpr){ s.y = -6*dpr; s.x = Math.random()*w; }
      const g = ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r*4);
      const a = 0.10 + 0.12*Math.sin(s.tw);
      g.addColorStop(0, `rgba(${s.rgb[0]},${s.rgb[1]},${s.rgb[2]},${0.65+a})`);
      g.addColorStop(1, `rgba(${s.rgb[0]},${s.rgb[1]},${s.rgb[2]},0)`);
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
    }
    rafId = requestAnimationFrame(draw);
  }
  const ro = new ResizeObserver(()=>{ requestAnimationFrame(resize) });
  ro.observe(document.documentElement);
  document.addEventListener('visibilitychange', ()=>{ if (document.hidden) cancelAnimationFrame(rafId); else draw(); });
  resize(); draw();
})();

/* しおぽん誘導（既存維持） */
(() => {
  const INVITE_ID='shiopon-invite', DOCK_ID='shiopon-dock';
  const KEY_HIDE_UNTIL='shiopon.hideUntil', HIDE_DAYS=3;
  const invite=document.getElementById(INVITE_ID);
  const dock=document.getElementById(DOCK_ID);
  if(!invite||!dock) return;

  let lastFocus=null;
  const closeBtn = invite.querySelector('.shiopon__close');
  const ctaBtn   = invite.querySelector('.shiopon__cta');

  function trapFocus(e){
    if(invite.classList.contains('is-hidden')) return;
    const f = invite.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])');
    if(!f.length) return;
    const first=f[0], last=f[f.length-1];
    if(e.key === 'Tab'){
      if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
    }else if(e.key === 'Escape'){ hideInvite(HIDE_DAYS, true); }
  }
  function showInvite(){ lastFocus=document.activeElement; invite.classList.remove('is-hidden'); dock.classList.add('is-hidden'); (ctaBtn||closeBtn)?.focus(); document.addEventListener('keydown', trapFocus); }
  function hideInvite(days=HIDE_DAYS, restoreFocus=false){
    const until=Date.now()+days*24*60*60*1000;
    localStorage.setItem(KEY_HIDE_UNTIL, String(until));
    invite.classList.add('is-hidden'); dock.classList.remove('is-hidden');
    document.removeEventListener('keydown', trapFocus);
    if(restoreFocus){ (lastFocus||dock)?.focus?.(); }
  }
  function canShow(){ return Date.now() > Number(localStorage.getItem(KEY_HIDE_UNTIL) || 0); }

  if (canShow()){
    setTimeout(()=>{ if (window.innerHeight>640 && window.scrollY<80) showInvite(); }, 4000);
    let shown=false;
    const onScroll=()=>{ if(!shown && window.innerHeight>640 && window.scrollY<80){ showInvite(); shown=true; window.removeEventListener('scroll',onScroll); } };
    window.addEventListener('scroll', onScroll, { passive:true });
  }else{
    dock.classList.remove('is-hidden');
  }
  invite.querySelector('.shiopon__close')?.addEventListener('click', ()=> hideInvite(HIDE_DAYS, true));
  dock.addEventListener('click', showInvite);
  invite.querySelector('.shiopon__cta')?.addEventListener('click', ()=>{ hideInvite(HIDE_DAYS, true); dock.classList.add('is-hidden'); });
})();

/* ヘッダーの可視化＆現在地ハイライト（既存＋安定化） */
(() => {
  const headerEl = document.querySelector('header');
  if (!headerEl) return;
  const revealAt = 8, compactAt = 88; let ticking=false;
  function onScroll(){
    const y=window.scrollY;
    if (y>revealAt) headerEl.classList.add('is-visible'); else headerEl.classList.remove('is-visible');
    if (y>compactAt) headerEl.classList.add('header--compact'); else headerEl.classList.remove('header--compact');
    ticking=false;
  }
  window.addEventListener('scroll',()=>{ if(!ticking){ window.requestAnimationFrame(onScroll); ticking=true; } },{passive:true});
  onScroll();

  const links = {
    trinity: document.querySelector('.nav a[href="#trinity"]'),
    writings: document.querySelector('.nav a[href="#writings"]'),
    join: document.querySelector('.nav a[href="#join"]'),
  };
  const observer = new IntersectionObserver((entries)=>{
    entries.forEach((e)=>{
      if (e.isIntersecting){
        Object.values(links).forEach(a=>a && a.classList.remove('is-active'));
        const id=e.target.getAttribute('id'); if (links[id]) links[id].classList.add('is-active');
      }
    });
  },{rootMargin:"calc(-1 * var(--header-h)) 0px -55% 0px",threshold:0.01});
  ['trinity','writings','join'].forEach(id=>{ const sec=document.getElementById(id); if (sec) observer.observe(sec); });
})();

/* トリニティ動画：タップで音ON（説明文も追加済み） */
(() => {
  const video = document.getElementById('trinityVideo');
  if (!video) return;
  let isControlled=false;
  function toggleLoopPlay(){
    if (video.paused){
      video.muted=false; video.loop=true; video.onended=null; video.play(); isControlled=true;
    } else { video.pause(); }
  }
  function setupVideoControls(){
    if (isControlled) return;
    video.onended = ()=>{ video.pause(); };
    video.addEventListener('click', toggleLoopPlay);
  }
  video.addEventListener('loadedmetadata', () => {
    const p = video.play();
    if (p && p.then){ p.then(()=>setupVideoControls()).catch(()=>setupVideoControls()); }
  });
  if (video.readyState >= 3){ video.play().catch(()=>{}); setupVideoControls(); }
})();

/* ★追加：全書アコーディオン開閉 */
(() => {
  const btn = document.getElementById('codex-toggle');
  const panel = document.getElementById('codex-panel');
  if (!btn || !panel) return;

  function openPanel(){
    panel.hidden=false;
    const start={height:'0px',opacity:0}, end={height:panel.scrollHeight+'px',opacity:1};
    if (panel.animate){
      panel.animate([start,end],{duration:260,easing:'cubic-bezier(.2,.6,.2,1)'}).onfinish=()=>{panel.style.height='auto';panel.style.opacity=1;};
      panel.style.height=panel.scrollHeight+'px'; panel.style.opacity=1;
    } else { panel.style.height='auto'; panel.style.opacity=1; }
    panel.querySelectorAll('li').forEach((li,i)=>{ li.style.animation=`codexFadeIn .32s ${80+i*18}ms both`; });
  }
  function closePanel(){
    const current = panel.getBoundingClientRect().height;
    if (panel.animate){
      panel.animate([{height:current+'px',opacity:1},{height:'0px',opacity:0}],{duration:220,easing:'cubic-bezier(.2,.6,.2,1)'}).onfinish=()=>{panel.hidden=true;panel.style.height='';panel.style.opacity='';};
    } else { panel.hidden=true; panel.style.height=''; panel.style.opacity=''; }
  }
  btn.addEventListener('click', ()=>{
    const expanded = btn.getAttribute('aria-expanded')==='true';
    btn.setAttribute('aria-expanded', String(!expanded));
    if (!expanded) openPanel(); else closePanel();
  });
  btn.addEventListener('keydown',(e)=>{ if (e.key==='Enter'||e.key===' '||e.code==='Space'){ e.preventDefault(); btn.click(); } });
})();
</script>

</body>
</html>
